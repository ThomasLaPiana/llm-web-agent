---
# Heavy load test - Stress testing with complex browser automation workflows using real sessions
base: 'http://localhost:3000'
iterations: 50
concurrency: 10
rampup: 10

plan:
  # Fast endpoints for baseline testing
  - name: health_check
    request:
      url: /health
      method: GET
    
  - name: root_check
    request:
      url: /
      method: GET
    
  # Session creation and workflow - the core functionality
  - name: create_session
    request:
      url: /browser/session
      method: POST
      headers:
        Content-Type: 'application/json'
      body: '{}'
    assign: session_response
    
  # Navigation testing with real session IDs
  - name: navigate_httpbin
    request:
      url: /browser/navigate
      method: POST
      headers:
        Content-Type: 'application/json'
      body: |
        {
          "session_id": "{{ session_response.body.session_id }}", 
          "url": "https://httpbin.org/html"
        }
        
  - name: navigate_example
    request:
      url: /browser/navigate
      method: POST
      headers:
        Content-Type: 'application/json'
      body: |
        {
          "session_id": "{{ session_response.body.session_id }}",
          "url": "https://example.com"
        }
    
  # Browser interactions with real session IDs
  - name: interact_screenshot
    request:
      url: /browser/interact
      method: POST
      headers:
        Content-Type: 'application/json'
      body: |
        {
          "session_id": "{{ session_response.body.session_id }}",
          "action": {
            "type": "Screenshot"
          }
        }
        
  - name: interact_page_source
    request:
      url: /browser/interact
      method: POST
      headers:
        Content-Type: 'application/json'
      body: |
        {
          "session_id": "{{ session_response.body.session_id }}",
          "action": {
            "type": "GetPageSource"
          }
        }
        
  - name: interact_wait
    request:
      url: /browser/interact
      method: POST
      headers:
        Content-Type: 'application/json'
      body: |
        {
          "session_id": "{{ session_response.body.session_id }}",
          "action": {
            "type": "Wait",
            "params": {
              "duration_ms": 500
            }
          }
        }

# Realistic delays to simulate real browser automation workflows
delay: '500..2000'

reports:
  - name: console
  - name: html
    file: drill-heavy-report.html
  - name: json
    file: drill-heavy-report.json 